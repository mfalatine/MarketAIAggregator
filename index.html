<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market AI Aggregator</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <header>
            <h1>Market AI Aggregator <span class="version">X3</span></h1>
            <nav class="tab-nav">
                <button class="tab-btn active" data-tab="dashboard">Dashboard</button>
                <button class="tab-btn" data-tab="history">History</button>
                <button class="tab-btn" data-tab="settings">Settings</button>
                <button class="tab-btn" data-tab="admin">üîß Admin</button>
                <button class="tab-btn" data-tab="guide">üìñ Guide</button>
            </nav>
        </header>

        <main>
            <!-- ==================== DASHBOARD TAB ==================== -->
            <div id="tab-dashboard" class="tab-content active">
                <div id="dashboard-banner"></div>
                <div class="card" id="generate-section">
                    <h3>Generate Briefing</h3>
                    <div class="input-row">
                        <div class="field">
                            <label for="dashboard-model">Model</label>
                            <select id="dashboard-model"></select>
                        </div>
                        <div class="field" style="flex:0">
                            <label>&nbsp;</label>
                            <button class="btn btn-primary" onclick="buildPrompt()">‚ñ∂ Build Prompt</button>
                        </div>
                    </div>
                </div>

                <div class="card" id="prompt-section">
                    <h3>Assembled Prompt</h3>
                    <textarea id="prompt-textarea" class="prompt-textarea"></textarea>
                    <p class="prompt-hint">Edits here are one-time only. To change the template permanently, use the Admin tab.</p>
                    <div class="button-row">
                        <button class="btn" onclick="resetPrompt()">‚Ü∫ Reset to Template</button>
                        <button class="btn btn-primary" id="btn-run" onclick="runBriefing()">‚ñ∂ Run Briefing</button>
                    </div>
                </div>

                <div class="card" id="status-section">
                    <div class="status-line">
                        <span class="spinner"></span>
                        <span id="status-text">Generating briefing...</span>
                    </div>
                </div>

                <div class="card" id="briefing-section">
                    <div class="briefing-header">
                        <h3 id="briefing-date"></h3>
                        <div class="briefing-meta">
                            <span id="briefing-model"></span>
                            <span id="briefing-time"></span>
                            <span id="briefing-modified" class="modified-flag" style="display:none" onclick="viewSentPrompt()">[modified from template]</span>
                        </div>
                    </div>
                    <div id="briefing-content" class="briefing-body"></div>
                    <div class="export-row">
                        <label><input type="checkbox" id="chk-snapshot"> Include Settings Snapshot</label>
                        <button class="btn btn-sm" onclick="copyBriefing()">üìã Copy</button>
                        <button class="btn btn-sm" onclick="exportBriefingHTML()">üìÑ Export HTML</button>
                        <button class="btn btn-sm" onclick="printBriefing()">üñ® Print</button>
                        <button class="btn btn-sm" onclick="regenerateBriefing()">üîÑ Regenerate</button>
                    </div>
                </div>
            </div>

            <!-- ==================== HISTORY TAB ==================== -->
            <div id="tab-history" class="tab-content">
                <div class="card">
                    <div class="history-header">
                        <h3>Briefing History</h3>
                        <input type="text" id="history-search" class="history-search" placeholder="Search briefings...">
                    </div>
                    <div id="history-list"></div>
                    <div class="button-row" id="history-compare-row" style="display:none">
                        <button class="btn btn-primary btn-sm" onclick="compareSelected()">Compare Selected</button>
                    </div>
                </div>

                <div class="card" id="history-view" style="display:none">
                    <div class="button-row" style="margin-top:0;margin-bottom:12px">
                        <button class="btn btn-sm" onclick="backToHistoryList()">‚Üê Back to List</button>
                        <button class="btn btn-sm" onclick="viewHistoryPrompt()">View Prompt Sent</button>
                    </div>
                    <div id="history-briefing-header"></div>
                    <div id="history-briefing-content" class="briefing-body"></div>
                </div>

                <div class="card" id="history-compare" style="display:none">
                    <div class="button-row" style="margin-top:0;margin-bottom:12px">
                        <button class="btn btn-sm" onclick="backToHistoryList()">‚Üê Back to List</button>
                    </div>
                    <div class="compare-container">
                        <div class="compare-side" id="compare-left"></div>
                        <div class="compare-side" id="compare-right"></div>
                    </div>
                </div>
            </div>

            <!-- ==================== SETTINGS TAB ==================== -->
            <div id="tab-settings" class="tab-content">
                <div id="settings-banner"></div>

                <div class="card">
                    <h3>Theme</h3>
                    <div class="theme-options" id="theme-options">
                        <label class="theme-option" data-theme="light">
                            <input type="radio" name="settings-theme" value="light">
                            <div class="theme-swatch">
                                <div class="theme-swatch-top" style="background:#1a1a2e"></div>
                                <div class="theme-swatch-bottom" style="background:#f0f2f5"></div>
                            </div>
                            <div class="theme-option-info">
                                <div class="theme-option-name">Light</div>
                                <div class="theme-option-desc">Default clean look</div>
                            </div>
                        </label>
                        <label class="theme-option" data-theme="dark">
                            <input type="radio" name="settings-theme" value="dark">
                            <div class="theme-swatch">
                                <div class="theme-swatch-top" style="background:#0a0c12"></div>
                                <div class="theme-swatch-bottom" style="background:#0f1117"></div>
                            </div>
                            <div class="theme-option-info">
                                <div class="theme-option-name">Dark</div>
                                <div class="theme-option-desc">Easy on the eyes</div>
                            </div>
                        </label>
                        <label class="theme-option" data-theme="umich">
                            <input type="radio" name="settings-theme" value="umich">
                            <div class="theme-swatch">
                                <div class="theme-swatch-top" style="background:#00274C"></div>
                                <div class="theme-swatch-bottom" style="background:#FFCB05"></div>
                            </div>
                            <div class="theme-option-info">
                                <div class="theme-option-name">Go Blue!</div>
                                <div class="theme-option-desc">Maize &amp; Blue forever</div>
                            </div>
                        </label>
                    </div>
                </div>

                <div class="card" id="api-config-card">
                    <h3 id="api-config-title">API Configuration</h3>
                    <div class="card-section">
                        <label for="settings-apikey">Anthropic API Key</label>
                        <div class="input-group">
                            <input type="password" id="settings-apikey" placeholder="sk-ant-...">
                            <button class="btn" onclick="toggleApiKeyVis('settings-apikey')">Show</button>
                        </div>
                        <div class="status-line" id="apikey-status">
                            <span class="status-dot gray"></span> Not Set
                        </div>
                    </div>
                    <div class="card-section">
                        <label for="settings-gemini-key">Google Gemini API Key</label>
                        <div class="input-group">
                            <input type="password" id="settings-gemini-key" placeholder="AIza...">
                            <button class="btn" onclick="toggleApiKeyVis('settings-gemini-key')">Show</button>
                        </div>
                        <div class="status-line" id="gemini-key-status">
                            <span class="status-dot gray"></span> Not Set
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>Model Selection</h3>
                    <div id="settings-models" class="radio-group"></div>
                </div>

                <div class="card">
                    <h3>Briefing Topics</h3>
                    <div id="settings-topics"></div>
                </div>

                <div class="card">
                    <h3>Watchlist</h3>
                    <div class="card-section">
                        <label>Tickers</label>
                        <div class="tag-container" id="watchlist-tags"></div>
                        <div class="input-group" style="max-width:200px">
                            <input type="text" id="watchlist-input" placeholder="Add ticker" maxlength="5">
                            <button class="btn" onclick="addWatchlistTicker()">+</button>
                        </div>
                    </div>
                    <div class="card-section">
                        <label>Watchlist Coverage</label>
                        <div id="settings-coverage" class="checkbox-group"></div>
                    </div>
                </div>

                <div class="card">
                    <h3>Output Preferences</h3>
                    <div class="card-section">
                        <label>Briefing Style</label>
                        <div id="settings-styles" class="radio-group"></div>
                    </div>
                    <div class="card-section">
                        <label for="settings-instructions">Custom Instructions</label>
                        <textarea id="settings-instructions" rows="3"></textarea>
                    </div>
                </div>

                <div class="card">
                    <h3>Data Management</h3>
                    <div class="data-section">
                        <div class="data-row-label">Settings</div>
                        <div class="data-row">
                            <button class="btn btn-sm" onclick="exportSettings()">Export Settings JSON</button>
                            <button class="btn btn-sm" onclick="importSettings()">Import Settings JSON</button>
                        </div>
                        <div class="data-row-desc">API key, model, topics, watchlist, style, custom instructions</div>
                    </div>
                    <div class="data-section">
                        <div class="data-row-label">History</div>
                        <div class="data-row">
                            <button class="btn btn-sm" onclick="exportHistory()">Export History JSON</button>
                            <button class="btn btn-sm" onclick="importHistory()">Import History JSON</button>
                        </div>
                        <div class="data-row-desc">All past briefings with dates, model used, and content</div>
                    </div>
                    <div class="data-section">
                        <div class="data-row-label">Full Backup</div>
                        <div class="data-row">
                            <button class="btn btn-sm" onclick="exportEverything()">Export Everything</button>
                            <button class="btn btn-sm" onclick="importEverything()">Import Everything</button>
                        </div>
                        <div class="data-row-desc">Settings + History in one file</div>
                    </div>
                    <div class="danger-zone">
                        <h4>Danger Zone</h4>
                        <div class="data-row">
                            <button class="btn btn-danger btn-sm" onclick="clearHistoryOnly()">Clear History Only</button>
                            <button class="btn btn-danger btn-sm" onclick="resetEverything()">Reset Everything</button>
                        </div>
                    </div>
                </div>

                <div class="button-row button-row-right">
                    <button class="btn btn-primary" onclick="saveAllSettings()">Save Settings</button>
                </div>
            </div>

            <!-- ==================== ADMIN TAB ==================== -->
            <div id="tab-admin" class="tab-content">
                <!-- Topic Management -->
                <div class="card admin-section">
                    <h3>Topic Management</h3>
                    <div class="field" style="max-width:250px;margin-bottom:12px">
                        <label for="admin-topic-filter">Category Filter</label>
                        <select id="admin-topic-filter" onchange="renderTopicManagement()">
                            <option value="all">All Categories</option>
                        </select>
                    </div>
                    <div id="admin-topic-list"></div>
                    <button class="btn btn-sm" onclick="toggleAdminForm('topic-form')" id="btn-add-topic">+ Add Topic</button>
                    <div class="admin-form" id="topic-form">
                        <div class="field">
                            <label>Category</label>
                            <select id="topic-form-category"></select>
                        </div>
                        <div class="field">
                            <label>Display Name</label>
                            <input type="text" id="topic-form-name" oninput="autoGenerateKey()">
                        </div>
                        <div class="field">
                            <label>Key</label>
                            <input type="text" id="topic-form-key">
                        </div>
                        <div class="field">
                            <label>Prompt Hint</label>
                            <textarea id="topic-form-hint" rows="2" placeholder="What should Claude search for when this topic is enabled?"></textarea>
                        </div>
                        <div class="button-row">
                            <button class="btn btn-primary btn-sm" onclick="saveTopic()">Save Topic</button>
                            <button class="btn btn-sm" onclick="cancelTopicForm()">Cancel</button>
                        </div>
                    </div>
                </div>

                <!-- Category Management -->
                <div class="card admin-section">
                    <h3>Category Management</h3>
                    <div id="admin-category-list"></div>
                    <button class="btn btn-sm" onclick="toggleAdminForm('category-form')">+ Add Category</button>
                    <div class="admin-form" id="category-form">
                        <div class="input-row">
                            <div class="field">
                                <label>Name</label>
                                <input type="text" id="category-form-name">
                            </div>
                            <div class="field" style="max-width:80px">
                                <label>Sort</label>
                                <input type="number" id="category-form-sort" value="1" min="1">
                            </div>
                        </div>
                        <div class="button-row">
                            <button class="btn btn-primary btn-sm" onclick="saveCategory()">Save Category</button>
                            <button class="btn btn-sm" onclick="cancelCategoryForm()">Cancel</button>
                        </div>
                    </div>
                </div>

                <!-- Coverage Type Management -->
                <div class="card admin-section">
                    <h3>Watchlist Coverage Options</h3>
                    <div id="admin-coverage-list"></div>
                    <button class="btn btn-sm" onclick="toggleAdminForm('coverage-form')">+ Add Coverage Type</button>
                    <div class="admin-form" id="coverage-form">
                        <div class="field">
                            <label>Name</label>
                            <input type="text" id="coverage-form-name">
                        </div>
                        <div class="field">
                            <label>Prompt Instruction</label>
                            <textarea id="coverage-form-prompt" rows="2"></textarea>
                        </div>
                        <div class="button-row">
                            <button class="btn btn-primary btn-sm" onclick="saveCoverageType()">Save Coverage Type</button>
                            <button class="btn btn-sm" onclick="cancelCoverageForm()">Cancel</button>
                        </div>
                    </div>
                </div>

                <!-- Prompt Editor -->
                <div class="card admin-section">
                    <h3>Prompt Editor</h3>
                    <div class="card-section">
                        <label for="admin-system-prompt">System Prompt</label>
                        <textarea id="admin-system-prompt" rows="8"></textarea>
                        <div class="button-row">
                            <button class="btn btn-sm" onclick="resetSystemPrompt()">Reset to Default</button>
                            <button class="btn btn-primary btn-sm" onclick="saveSystemPrompt()">Save System Prompt</button>
                        </div>
                    </div>
                    <div class="card-section">
                        <label for="admin-user-template">User Prompt Template</label>
                        <textarea id="admin-user-template" rows="8"></textarea>
                        <div class="var-list">
                            Available variables: <code>{date}</code> <code>{enabled_topics}</code> <code>{watchlist}</code> <code>{coverage_types}</code> <code>{briefing_style}</code> <code>{custom_instructions}</code> <code>{topic_hints}</code>
                        </div>
                        <div class="button-row">
                            <button class="btn btn-sm" onclick="resetUserTemplate()">Reset to Default</button>
                            <button class="btn btn-primary btn-sm" onclick="saveUserTemplate()">Save Template</button>
                        </div>
                    </div>
                    <div class="card-section">
                        <button class="btn btn-sm" onclick="previewFullPrompt()">üëÅ Preview Full Prompt</button>
                        <div class="prompt-preview-box" id="prompt-preview"></div>
                    </div>
                </div>

                <!-- Style Management -->
                <div class="card admin-section">
                    <h3>Briefing Style Options</h3>
                    <div id="admin-style-list"></div>
                    <button class="btn btn-sm" onclick="toggleAdminForm('style-form')">+ Add Style</button>
                    <div class="admin-form" id="style-form">
                        <div class="input-row">
                            <div class="field"><label>Name</label><input type="text" id="style-form-name"></div>
                            <div class="field" style="max-width:120px"><label>Word Target</label><input type="number" id="style-form-words" value="500"></div>
                            <div class="field" style="max-width:120px"><label>Max Tokens</label><input type="number" id="style-form-tokens" value="1000"></div>
                        </div>
                        <div class="field">
                            <label>Description</label>
                            <input type="text" id="style-form-desc">
                        </div>
                        <div class="button-row">
                            <button class="btn btn-primary btn-sm" onclick="saveStyle()">Save Style</button>
                            <button class="btn btn-sm" onclick="cancelStyleForm()">Cancel</button>
                        </div>
                    </div>
                </div>

                <!-- Model Management -->
                <div class="card admin-section">
                    <h3>Model Management</h3>
                    <div id="admin-model-list"></div>
                    <button class="btn btn-sm" onclick="toggleAdminForm('model-form')">+ Add Model</button>
                    <div class="admin-form" id="model-form">
                        <div class="input-row">
                            <div class="field">
                                <label>Provider</label>
                                <select id="model-form-provider">
                                    <option value="anthropic">Anthropic</option>
                                    <option value="google">Google Gemini</option>
                                </select>
                            </div>
                            <div class="field">
                                <label>API Model ID</label>
                                <input type="text" id="model-form-id" placeholder="claude-sonnet-4-5-20250929">
                            </div>
                        </div>
                        <div class="input-row">
                            <div class="field"><label>Display Name</label><input type="text" id="model-form-name"></div>
                            <div class="field"><label>Cost Note</label><input type="text" id="model-form-cost" placeholder="Fast, ~$0.05/run"></div>
                        </div>
                        <div class="button-row">
                            <button class="btn btn-primary btn-sm" onclick="saveModel()">Save Model</button>
                            <button class="btn btn-sm" onclick="cancelModelForm()">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ==================== USER GUIDE TAB ==================== -->
            <div id="tab-guide" class="tab-content">
                <div class="card">
                    <h3>User Guide</h3>
                    <nav class="guide-nav">
                        <a href="#" onclick="scrollGuide('guide-start');return false">Getting Started</a>
                        <a href="#" onclick="scrollGuide('guide-dashboard');return false">Dashboard</a>
                        <a href="#" onclick="scrollGuide('guide-history');return false">History</a>
                        <a href="#" onclick="scrollGuide('guide-settings');return false">Settings</a>
                        <a href="#" onclick="scrollGuide('guide-admin');return false">Admin</a>
                        <a href="#" onclick="scrollGuide('guide-data');return false">Data &amp; Backup</a>
                        <a href="#" onclick="scrollGuide('guide-trouble');return false">Troubleshooting</a>
                        <a href="#" onclick="scrollGuide('guide-cost');return false">Cost Reference</a>
                    </nav>

                    <div class="guide-section" id="guide-start">
                        <h4>Getting Started</h4>
                        <p>This app generates AI-powered daily market briefings by sending a customized prompt to an AI API with web search enabled. Supports Anthropic (Claude) and Google Gemini models. The AI searches live sources (CME FedWatch, BLS, financial news) and synthesizes a briefing based on your selected topics, watchlist, and style preferences.</p>
                        <p>Everything runs in your browser. Your API keys and settings are stored in localStorage ‚Äî nothing is sent anywhere except the selected API when you click "Run Briefing."</p>
                        <p><strong>First-time setup:</strong></p>
                        <ol>
                            <li>Go to Settings ‚Üí enter your API key (Anthropic and/or Google Gemini)</li>
                            <li>Select your default model, topics, and watchlist</li>
                            <li>Go to Dashboard ‚Üí Build Prompt ‚Üí Run Briefing</li>
                        </ol>
                    </div>

                    <div class="guide-section" id="guide-dashboard">
                        <h4>Dashboard</h4>
                        <p><strong>Build Prompt</strong> ‚Äî Assembles a prompt from your saved template, enabled topics (with their prompt hints), watchlist, coverage types, and style setting. The result appears in an editable text area.</p>
                        <p class="note">No API call is made. Nothing is sent yet.</p>
                        <p><strong>Edit the Prompt (optional)</strong> ‚Äî You can modify the assembled prompt before running. Examples:</p>
                        <ul>
                            <li>Add a ticker: "Also cover AVGO today"</li>
                            <li>Shift focus: "Go deeper on Fed policy, skip techs"</li>
                            <li>Add context: "Note: NVDA earnings was yesterday"</li>
                        </ul>
                        <p class="note">Edits are one-time only. The saved template is not affected. Use Admin to change permanently.</p>
                        <p><strong>Run Briefing</strong> ‚Äî Sends the prompt to the Anthropic API with web search. Result is displayed and auto-saved to History. If the prompt was edited, it's flagged as "modified from template."</p>
                        <p><strong>Model Override</strong> ‚Äî The dropdown lets you override the default model for a single run. Use Sonnet for daily briefings, switch to Opus for deeper weekend reviews.</p>
                        <p class="note">Only affects this run. Default is not changed.</p>
                        <p><strong>Regenerate</strong> ‚Äî Re-runs the same prompt. New API call. Previous version remains in History.</p>
                        <p><strong>Copy / Export HTML / Print</strong> ‚Äî Local actions only, no API calls. Check "Include Settings Snapshot" to bundle configuration details with the export.</p>
                    </div>

                    <div class="guide-section" id="guide-history">
                        <h4>History</h4>
                        <p>Every generated briefing is automatically saved with its date, model used, prompt sent, and full response.</p>
                        <p><strong>View Past Briefing</strong> ‚Äî Click any entry to see the full briefing. Click "View Prompt" to see exactly what was sent.</p>
                        <p><strong>Compare</strong> ‚Äî Select two briefings to see a side-by-side comparison ‚Äî useful for tracking evolving narratives.</p>
                        <p><strong>Search</strong> ‚Äî Full-text search across all saved briefings.</p>
                        <p class="note">All history operations are local. No API calls.</p>
                    </div>

                    <div class="guide-section" id="guide-settings">
                        <h4>Settings</h4>
                        <p><strong>API Keys</strong> ‚Äî Separate keys for Anthropic and Google Gemini. Stored in localStorage only. Each is validated with a lightweight test call when saved.</p>
                        <p><strong>Default Model</strong> ‚Äî Sets which model is pre-selected on Dashboard. Can be overridden per-run.</p>
                        <p><strong>Topics</strong> ‚Äî Toggle which topics are included when building a prompt. Each has a prompt hint (editable in Admin).</p>
                        <p><strong>Watchlist</strong> ‚Äî Your tracked tickers, injected into the prompt so Claude searches for news about these symbols.</p>
                        <p><strong>Watchlist Coverage</strong> ‚Äî What type of information to gather per ticker (news, earnings, analyst changes, etc.).</p>
                        <p><strong>Output Style</strong> ‚Äî Controls response length, depth, and max_tokens sent to the API.</p>
                        <p><strong>Custom Instructions</strong> ‚Äî Free-text appended to every prompt for persistent preferences.</p>
                    </div>

                    <div class="guide-section" id="guide-admin">
                        <h4>Admin</h4>
                        <p>Admin controls <strong>what options exist</strong>. Settings controls <strong>which options are active</strong>. Think of Admin as building the menu, Settings as ordering from it.</p>
                        <p><strong>Topic Management</strong> ‚Äî Add, edit, or remove topics. Each has a display name, category, and prompt hint that tells Claude what to search for.</p>
                        <p><strong>Category Management</strong> ‚Äî Add or rename topic groupings. Sort order controls display sequence.</p>
                        <p><strong>Watchlist Coverage Types</strong> ‚Äî Define what types of coverage are available for watchlist tickers.</p>
                        <p><strong>Prompt Editor</strong> ‚Äî Direct access to the system prompt and user prompt template with variable placeholders.</p>
                        <p class="warning">‚ö† The system prompt defines Claude's persona and rules. Edit carefully ‚Äî bad system prompts produce bad briefings. Use "Reset to Default" if things go sideways.</p>
                        <p><strong>Briefing Styles</strong> ‚Äî Add custom styles beyond the defaults.</p>
                        <p><strong>Model Management</strong> ‚Äî Add new models from Anthropic or Google Gemini. Each model has a provider field that determines which API to call.</p>
                    </div>

                    <div class="guide-section" id="guide-data">
                        <h4>Data &amp; Backup</h4>
                        <p>All data lives in your browser's localStorage. Clearing browser data will erase everything. Use exports to protect your data.</p>
                        <table class="guide-table">
                            <thead><tr><th>Action</th><th>What It Does</th></tr></thead>
                            <tbody>
                                <tr><td>Export Settings</td><td>Config only, no history</td></tr>
                                <tr><td>Import Settings</td><td>Overwrites current config</td></tr>
                                <tr><td>Export History</td><td>All briefings as JSON</td></tr>
                                <tr><td>Import History</td><td>Merges with existing (no dupes)</td></tr>
                                <tr><td>Export Everything</td><td>Single backup file</td></tr>
                                <tr><td>Import Everything</td><td>Full restore</td></tr>
                            </tbody>
                        </table>
                        <p><strong>Moving to a new browser/machine:</strong></p>
                        <ol>
                            <li>Export Everything from old browser</li>
                            <li>Open app in new browser</li>
                            <li>Import Everything ‚Üí fully restored</li>
                        </ol>
                    </div>

                    <div class="guide-section" id="guide-trouble">
                        <h4>Troubleshooting</h4>
                        <p><strong>"API key invalid"</strong> ‚Äî Check your key at console.anthropic.com. Ensure it starts with "sk-ant-". Keys are project-scoped ‚Äî make sure it has Messages API access.</p>
                        <p><strong>Briefing is vague or missing data:</strong></p>
                        <ul>
                            <li>Check prompt hints in Admin ‚Äî vague hints produce vague results</li>
                            <li>Try Opus for deeper synthesis</li>
                            <li>Add specific instructions in the editable prompt</li>
                            <li>Web search can miss recent events ‚Äî try Regenerate</li>
                        </ul>
                        <p><strong>Briefing is too long / too short</strong> ‚Äî Adjust the style in Settings or edit max_tokens for the style in Admin.</p>
                        <p><strong>Response cut off mid-sentence</strong> ‚Äî max_tokens too low. Go to Admin ‚Üí Briefing Styles ‚Üí increase max_tokens.</p>
                        <p><strong>"Rate limited"</strong> ‚Äî Wait a minute and try again. Rare with single daily briefings.</p>
                    </div>

                    <div class="guide-section" id="guide-cost">
                        <h4>Cost Reference</h4>
                        <p>Costs are per-run and depend on model + response length + web searches:</p>
                        <table class="guide-table">
                            <thead><tr><th>Configuration</th><th>Estimated Cost</th></tr></thead>
                            <tbody>
                                <tr><td>Sonnet + Concise</td><td>~$0.03‚Äì0.05</td></tr>
                                <tr><td>Sonnet + Standard</td><td>~$0.05‚Äì0.10</td></tr>
                                <tr><td>Sonnet + Deep Dive</td><td>~$0.10‚Äì0.15</td></tr>
                                <tr><td>Opus + Concise</td><td>~$0.15‚Äì0.25</td></tr>
                                <tr><td>Opus + Standard</td><td>~$0.25‚Äì0.40</td></tr>
                                <tr><td>Opus + Deep Dive</td><td>~$0.40‚Äì0.60</td></tr>
                                <tr><td>Daily Sonnet/Standard</td><td>~$2‚Äì3/month</td></tr>
                                <tr><td>Daily Opus/Standard</td><td>~$8‚Äì12/month</td></tr>
                                <tr><td>Gemini Flash (any style)</td><td>Free (within limits)</td></tr>
                            </tbody>
                        </table>
                        <p>Check Anthropic usage at <strong>console.anthropic.com/usage</strong></p>
                        <p>Gemini free tier: 10 RPM, 250 RPD. Get your key at <strong>aistudio.google.com</strong></p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal -->
    <div class="modal-overlay" id="modal-overlay" onclick="closeModal(event)">
        <div class="modal" id="modal">
            <h3 id="modal-title"></h3>
            <div id="modal-body"></div>
            <div class="modal-actions">
                <button class="btn btn-sm" onclick="hideModal()">Close</button>
                <button class="btn btn-primary btn-sm" id="modal-confirm" style="display:none" onclick="confirmModal()">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <script src="app.js"></script>
</body>
</html>
